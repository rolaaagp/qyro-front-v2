<button
  type="button"
  class="fixed top-4 left-3 z-50 flex items-center justify-center w-10 h-10 rounded-lg bg-[color:var(--card)] transition-colors"
  (click)="toggle()"
>
  @if (open()) {
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 cursor-pointer select-none"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M6 18L18 6M6 6l12 12"
      />
    </svg>
  } @else {
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 cursor-pointer select-none"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M4 6h16M4 12h16M4 18h16"
      />
    </svg>
  }
</button>

<aside
  class="fixed top-0 left-0 h-screen border-r border-[color:var(--border)] bg-[color:var(--panel)]/80 backdrop-blur shadow-lg z-40 transition-all duration-300 overflow-y-auto"
  [ngClass]="{
    'w-64': open(),
    'w-0': !open(),
    'lg:w-64': open(),
    'lg:w-16': !open(),
  }"
>
  @if (open()) {
    <nav class="p-2 mt-[5em]">
      <ul class="space-y-1">
        @for (item of menu; track item.label) {
          <li>
            @if (!item.children?.length) {
              <a
                *ngIf="item.route"
                [routerLink]="item.route"
                class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-[color:var(--text)] hover:bg-[color:var(--chip-bg)]"
              >
                <span class="truncate">{{ item.label }}</span>
              </a>
              <button
                *ngIf="!item.route"
                type="button"
                class="w-full text-left flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-[color:var(--text)] hover:bg-[color:var(--chip-bg)]"
              >
                <span class="truncate">{{ item.label }}</span>
              </button>
            } @else {
              <button
                type="button"
                class="w-full flex items-center justify-between rounded-lg px-3 py-2 text-sm text-[color:var(--text)] hover:bg-[color:var(--chip-bg)]"
                (click)="toggleSection(item.label)"
              >
                <span class="truncate">{{ item.label }}</span>
                <span class="ml-2 text-[color:var(--muted)]">
                  {{ section()[item.label] ? "▾" : "▸" }}
                </span>
              </button>
              <div
                class="overflow-hidden transition-[max-height,opacity] duration-300"
                [ngStyle]="{
                  maxHeight: section()[item.label] && open() ? '500px' : '0px',
                  opacity: section()[item.label] && open() ? 1 : 0,
                }"
              >
                <ul class="mt-1 pl-3 border-l border-[color:var(--border)]">
                  @for (child of item.children; track child.label) {
                    <li>
                      <a
                        *ngIf="child.route"
                        [routerLink]="child.route"
                        class="block rounded-md px-3 py-2 text-sm text-[color:var(--text)] hover:bg-[color:var(--chip-bg)]"
                      >
                        {{ child.label }}
                      </a>
                      <button
                        *ngIf="!child.route"
                        type="button"
                        class="w-full text-left block rounded-md px-3 py-2 text-sm text-[color:var(--text)] hover:bg-[color:var(--chip-bg)]"
                      >
                        {{ child.label }}
                      </button>
                    </li>
                  }
                </ul>
              </div>
            }
          </li>
        }
      </ul>
    </nav>
  }
</aside>
